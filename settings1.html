<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>إعدادات الحساب</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=arrow_back" />

	<style>
	@import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Tajawal', sans-serif;
    direction: rtl;
}

body {
    background-color: #fff;
	  direction: rtl;

}

.back-button {
    position: absolute;
    right: 330px;
    top: 15px;
    text-decoration: none;
    font-size: 40px;
    color: #122C52;
}

.profile-title {
    font-size: 22px;
    color: #122C52;
    margin-top: 40px;
	text-align:center;
}

.profile-picture {
    width: 120px;
    height: 120px;
    margin: 10px auto;
    position: relative;
}

.profile-picture img {
    width: 100%;
    height: 100%;
    box-sizing: content-box;
    object-fit: cover;
    border-radius: 50%;
    border: 3px solid #122C52;
}

.edit-icon {
    position: absolute;
    bottom: 5px;
    right: 5px;
    background: #122C52;
    color: white;
    padding: 5px;
    border-radius: 50%;
    cursor: pointer;
}

.profile-form {
    display: flex;
    flex-direction: column;
    text-align: right;
    width: 90%;
    margin: 20px auto;
	
}

.profile-form label {
    font-weight: bold;
    color: #333;
    font-size: 14px;
    margin: 10px 0 5px;
}

.profile-form input, .profile-form textarea {
    padding: 12px;
    border-radius: 10px;
    width: 100%;
    background-color: #F3F3F3;
    font-size: 16px;
    border: none;
    margin-bottom: 10px;
}

.profile-form textarea {
    height: 80px;
    resize: none;
}

.profile-form button {
    background: #122C52;
    color: white;
    padding: 12px;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
    transition: 0.3s;
    width: 100%;
    margin-top: 15px;
}

.profile-form button:hover {
    background: #0E2140;
}

@media (max-width: 480px) {
    .profile-title {
        font-size: 20px;
    }

    .profile-form input, .profile-form textarea {
        font-size: 14px;
    }

    .profile-form button {
        font-size: 16px;
    }
}
    .material-symbols-outlined {
            font-size: 40px;
            color: #072D57;
            position: absolute;
            left: 2vw;
            margin-top: 5vh;
            cursor: pointer;
    }
   
</style>

<script type="module">
    import { auth, db } from './LogIn-Register.js';
    import { onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js';
    import { doc, getDoc, updateDoc } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js';
    import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js';
    
    const storage = getStorage();
    
    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const userRef = doc(db, "users", user.uid);
            const userSnap = await getDoc(userRef);
    
            if (userSnap.exists()) {
                const userData = userSnap.data();
    
                // عرض البيانات في الفورم
                document.getElementById("username").value = userData.username || "";
                document.getElementById("email").value = userData.email || "";
                document.getElementById("linkedinHandle").value = userData.contactInfo?.linkedinHandle || "";
                document.getElementById("xHandle").value = userData.contactInfo?.xHandle || "";
    
                // عرض صورة الملف الشخصي
                const profileImg = document.querySelector(".profile-picture img");
                if (userData.profileImage) {
                    profileImg.src = userData.profileImage;
                }
    
            } else {
                alert("تعذر تحميل بيانات المستخدم.");
            }
        } else {
            window.location.href = "login.html";
        }
    });
    </script>

</head>
<body>
    <span class="material-symbols-outlined" onclick="history.back();">arrow_back</span><br>
	<br>
    <h2 class="profile-title">سارة عبدالله</h2>

    <div class="profile-picture">
        <img src="images/innovator7.jpg" alt="الصورة الشخصية">
        <label class="edit-icon">&#9998;</label>
    </div>

    <form class="profile-form">
        <label for="username">اسم المستخدم</label>
        <input type="text" id="username" placeholder="saral2al">

        <label for="email">البريد الإلكتروني</label>
        <input type="email" id="email" placeholder="Sara@gmail.com">

        <label for="password">كلمة المرور</label>
        <input type="password" id="password" placeholder="********">

        <label for="linkedinHandle">حساب LinkedIn</label>
        <input type="text" id="linkedinHandle" placeholder="اسم المستخدم في LinkedIn">

        <label for="xHandle">حساب X</label>
        <input type="text" id="xHandle" placeholder="@yourhandle">

        <label for="profileImage">تغيير الصورة الشخصية</label>
        <input type="file" id="profileImage" accept="image/*">

        <label for="bio">نبذة</label>
        <textarea id="bio" placeholder="شخص طموح أسعى دائمًا للابتكار وتطوير الحلول الحديثة. أحب استكشاف الأفكار الجديدة التي تساهم في تحسين الحياة من حولي."></textarea>

        <button type="submit">حفظ التعديلات</button>
    </form>



    <script type="module">
        import { auth, db } from './LogIn-Register.js';
        import { doc, updateDoc } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js';
        
        const storage = getStorage();
        
        document.querySelector(".profile-form").addEventListener("submit", async (e) => {
            e.preventDefault();
        
            const username = document.getElementById("username").value.trim();
            const email = document.getElementById("email").value.trim();
            const linkedinHandle = document.getElementById("linkedinHandle").value.trim();
            const xHandle = document.getElementById("xHandle").value.trim();
            const profileImageFile = document.getElementById("profileImage").files[0];
        
            const user = auth.currentUser;
            if (!user) {
                alert("لا يوجد مستخدم مسجل دخول.");
                return;
            }
        
            let profileImageURL = null;
        
            // إذا المستخدم رفع صورة جديدة
            if (profileImageFile) {
                const storageRef = ref(storage, `profileImages/${user.uid}`);
                const snapshot = await uploadBytes(storageRef, profileImageFile);
                profileImageURL = await getDownloadURL(snapshot.ref);
            }
        
            const userRef = doc(db, "users", user.uid);
        
            const updatedData = {
                username,
                email,
                contactInfo: {
                    linkedinHandle,
                    xHandle
                }
            };
        
            if (profileImageURL) {
                updatedData.profileImage = profileImageURL;
            }
        
            try {
                await updateDoc(userRef, updatedData);
                alert("تم حفظ التعديلات بنجاح!");
                location.reload();
            } catch (error) {
                console.error("خطأ في حفظ التعديلات:", error);
                alert("حدث خطأ، يرجى المحاولة لاحقاً.");
            }
        });
        </script>
        
</body>
</html>


